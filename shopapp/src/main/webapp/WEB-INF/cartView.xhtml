<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head>

</h:head>

<h:body>
	<!-- <p:messages id="messages" /> -->
	
	<h:form id="form">
	
	<p:dataTable var="cartItem" value="#{cartView.thecart}" id="cartTable">

		<p:column headerText="Name">
			<h:outputText value="#{cartItem.product.name}" />
		</p:column>

		<p:column headerText="Description">
			<h:outputText value="#{cartItem.product.description}" />
		</p:column>

		<p:column headerText="Price">
			<h:outputText value="#{cartItem.product.price}" />
		</p:column>

		<p:column headerText="Image">
			<img src="#{cartItem.product.imageFile}" />
		</p:column>

		<p:column headerText="Quantity">
			
			
			<h:inputText value="#{cartItem.amount}" style="padding-left: 10px"/>  
			
		</p:column>

		<p:column headerText="Item Total">
			<h:outputText value="#{cartItem.totalPrice}" />
		</p:column>

		
	</p:dataTable>
	
	<p:commandButton value="Update" icon="ui-icon-arrowrefresh-1-e" action="#{cartView.update}" update=":form"/>
	<p:commandButton value="Checkout" icon="ui-icon-arrowrefresh-1-e" oncomplete="if (!args.loggedIn) PF('customerLoginDialog').show()"/>
	</h:form>
	
	

	<p:dialog widgetVar="customerLoginDialog" closeOnEscape="true" modal="true" header="Customer Login">
		<h:form id="customerLoginForm">
		<p:growl id="messages" sticky="true" showDetail="true" life="3000"/>
			<p:panelGrid columns="2" cellpadding="5">
				<h:outputLabel for="email" value="Email:" />
            	<p:inputText id="email" value="#{cartView.email}" required="true" label="email" />
 
            	<h:outputLabel for="password" value="Password:" />
            	<p:password id="password" value="#{cartView.password}" required="true" label="password" />
			</p:panelGrid>
	
			<p:commandButton value="Login" update="messages" action="#{cartView.checkout}" oncomplete="handleDialogSubmit(args, 'customerLoginDialog')" />

		</h:form>
	</p:dialog>

	<script type="text/javascript">
	    function handleDialogSubmit(args, dialogName)  {
	        if(args.validationFailed || !args.loggedIn) {
	            PF(dialogName).jq.effect("shake", {times:5}, 100);
	        }
	        else {
	            PF(dialogName).hide();
	            $('#loginLink').fadeOut();
	        }
	    }
	</script>


</h:body>
</html>